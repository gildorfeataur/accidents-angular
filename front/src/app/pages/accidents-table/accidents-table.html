<app-navigation></app-navigation>

<app-filter></app-filter>

<section class="table" [class.loading]="accidentsStore.loading()" [class.error]="accidentsStore.error()">

  @if (accidentsStore.loading()) {
  <div class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Завантаження даних...</p>
  </div>
  }

  @if (accidentsStore.error()) {
  <div class="error-container">
    <p>{{ accidentsStore.error() }}</p>
  </div>
  }

  @if (!accidentsStore.loading() && !accidentsStore.error() && accidentsStore.accidents().length === 0) {
  <div class="no-data-container">
    <p>Немає даних про аварії</p>
  </div>
  }

  @if (!accidentsStore.loading() && !accidentsStore.error() && accidentsStore.accidents().length > 0) {
  <div class="accidents-table">
    <div class="table-header">
      <div class="header-cell title-col">Назва</div>
      <div class="header-cell type-col">Категорія</div>
      <div class="header-cell status-col">Важкість</div>
      <div class="header-cell coords-col">Координати</div>
      <div class="header-cell time-col">Час</div>
    </div>

    <div class="table-body">
      @for (accident of accidentPageElements; track accident.id) {
      <div class="table-row" [class]="'accident-' + accident.severity">
        <div class="table-cell title-col">
          <a routerLink="/accidents/{{ accident.id }}">{{ accident.title }}</a>
        </div>
        <div class="table-cell type-col">
          <span class="accident-type">{{ accident.category }}</span>
        </div>
        <div class="table-cell status-col">
          <span class="status-badge status-{{ accident.severity }}">{{ accident.severity }}</span>
        </div>
        <div class="table-cell coords-col">
          {{ accident.lat }}, {{ accident.lng }}
        </div>
        <div class="table-cell time-col">
          {{ accident.createdAt | date:'dd.MM.yyyy HH:mm' }}
        </div>
      </div>
      }
    </div>
  </div>

  <div class="pagination-container">
    <div class="pagination-controls">
      <button class="pagination-btn prev-btn" (click)="previousPage()" [disabled]="page === 1"
        [class.disabled]="page === 1">
        <span class="btn-text">Попередня</span>
      </button>

      <div class="page-numbers">
        <span class="current-page">{{ page }}</span>
        <span class="page-separator">/</span>
        <span class="total-pages">{{ totalPages }}</span>
      </div>

      <button class="pagination-btn next-btn" (click)="nextPage()" [disabled]="page >= totalPages"
        [class.disabled]="page >= totalPages">
        <span class="btn-text">Наступна</span>
      </button>
    </div>
  </div>
  }
</section>